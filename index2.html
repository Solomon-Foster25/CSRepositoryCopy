<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Asteroids — Single Page</title>
  <style>
    :root{
      --bg:#0b0f14; --fg:#e8f0fe; --accent:#68d391; --muted:#9aa0a6; --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--fg);overflow:hidden}
    #game{position:fixed;inset:0;background:radial-gradient(1200px 800px at 50% 40%,#121826 0%,#0b0f14 60%,#070a0f 100%)}

    .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
    .panel{pointer-events:auto;background:rgba(10,14,20,.8);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.08);box-shadow:0 20px 60px rgba(0,0,0,.5);border-radius:20px;padding:32px;max-width:680px;width:min(92%,680px);text-align:center}
    h1{font-weight:800;letter-spacing:.5px;margin:.2rem 0 0;font-size:clamp(28px,4vw,44px)}
    h2{font-weight:700;margin:0 0 1rem;font-size:clamp(18px,2.2vw,22px);color:var(--muted)}
    .btn{display:inline-flex;gap:.6rem;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,.15);border-radius:14px;padding:12px 18px;font-weight:700;cursor:pointer;background:linear-gradient(180deg,#1a2332,#101827);color:var(--fg);transition:transform .08s ease, box-shadow .2s ease}
    .btn:hover{transform:translateY(-1px);box-shadow:0 8px 24px rgba(0,0,0,.35)}
    .btn:active{transform:translateY(0)}
    .grid{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));margin-top:14px;text-align:left}
    .kbd{display:inline-block;border:1px solid rgba(255,255,255,.2);border-bottom-width:3px;border-radius:8px;padding:.2rem .45rem;font-family:ui-monospace,Consolas,monospace;background:#0e1522}
    .muted{color:var(--muted)}

    #hud{position:fixed;inset:0;pointer-events:none;padding:14px;display:flex;justify-content:space-between;align-items:flex-start;font-weight:700;letter-spacing:.2px}
    #hud .left, #hud .right{display:flex;gap:16px;align-items:center}
    #hud .chip{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);border-radius:999px;padding:6px 10px}
    #hud .pause{position:fixed;left:50%;top:12px;transform:translateX(-50%);background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:6px 12px}

    #pauseOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center}
    #pauseOverlay .panel{border-color:rgba(255,255,255,.18)}

    /* Command palette */
    #cmdWrap{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);width:min(760px,92%);display:none}
    #cmd{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.16);background:rgba(6,10,16,.9);backdrop-filter:blur(6px);color:var(--fg);font-size:16px;outline:none}
    #cmd::placeholder{color:#7a8699}

    /* Small helper to show focus ring accessibility */
    .btn:focus-visible, #cmd:focus-visible{outline:2px solid var(--accent);outline-offset:2px}

    @media (max-width: 640px){
      .grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <canvas id="game"></canvas>

  <!-- HUD -->
  <div id="hud">
    <div class="left">
      <div class="chip">Score: <span id="score">0</span></div>
      <div class="chip">Lives: <span id="lives">3</span></div>
      <div class="chip">Level: <span id="level">1</span></div>
    </div>
    <div class="right">
      <div class="chip muted">Press <span class="kbd">P</span> to Pause</div>
    </div>
  </div>

  <!-- Splash Screen -->
  <div class="overlay" id="splash">
    <div class="panel">
      <h1>ASTEROIDS</h1>
      <h2>Single‑file HTML5 edition</h2>
      <button id="startBtn" class="btn" aria-label="Start Game">▶ Start</button>
      <div class="grid">
        <div>
          <strong>Move</strong><br/>
          <span class="kbd">←</span> <span class="kbd">→</span> rotate<br/>
          <span class="kbd">↑</span> thrust
        </div>
        <div>
          <strong>Fire</strong><br/>
          <span class="kbd">Space</span>
        </div>
        <div>
          <strong>Pause</strong><br/>
          <span class="kbd">P</span> or type <span class="kbd">pause</span>
        </div>
        <div>
          <strong>Command</strong><br/>
          Press <span class="kbd">/</span> to type
        </div>
      </div>
      <p class="muted" style="margin-top:12px">Tip: The screen wraps. Split big rocks into smaller ones for more points.</p>
    </div>
  </div>

  <!-- Pause Overlay -->
  <div id="pauseOverlay" class="overlay">
    <div class="panel">
      <h1>Paused</h1>
      <p class="muted">Press <span class="kbd">P</span> or type <span class="kbd">resume</span></p>
      <div style="margin-top:10px">
        <button id="resumeBtn" class="btn">⏯ Resume</button>
        <button id="restartBtn" class="btn" style="margin-left:8px">↻ Restart</button>
      </div>
    </div>
  </div>

  <!-- Command palette -->
  <div id="cmdWrap"><input id="cmd" type="text" placeholder="Type a command… (pause, resume, restart, start)" autocomplete="off" /></div>

  <script>
  (()=>{
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    // HUD
    const scoreEl = document.getElementById('score');
    const livesEl = document.getElementById('lives');
    const levelEl = document.getElementById('level');

    // UI elements
    const splash = document.getElementById('splash');
    const startBtn = document.getElementById('startBtn');
    const pauseOverlay = document.getElementById('pauseOverlay');
    const resumeBtn = document.getElementById('resumeBtn');
    const restartBtn = document.getElementById('restartBtn');
    const cmdWrap = document.getElementById('cmdWrap');
    const cmd = document.getElementById('cmd');

    // ----- Helpers -----
    const randRange = (min,max)=>Math.random()*(max-min)+min;
    const clamp=(v,min,max)=>v<min?min:(v>max?max:v);
    const TAU = Math.PI*2;

    function fitCanvas(){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      const w = window.innerWidth;
      const h = window.innerHeight;
      canvas.width = Math.floor(w * dpr);
      canvas.height = Math.floor(h * dpr);
      canvas.style.width = w + 'px';
      canvas.style.height = h + 'px';
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }

    window.addEventListener('resize', fitCanvas);
    fitCanvas();

    // ----- Game State -----
    const State = { SPLASH:'splash', PLAYING:'playing', PAUSED:'paused', GAMEOVER:'gameover' };
    let state = State.SPLASH;

    const game = {
      score: 0,
      lives: 3,
      level: 1,
      ship: null,
      bullets: [],
      asteroids: [],
      particles: [],
      lastShot: 0,
    };

    // ----- Entities -----
    function makeShip(){
      return {
        x: canvas.clientWidth/2,
        y: canvas.clientHeight/2,
        vx: 0, vy: 0,
        angle: -Math.PI/2,
        thrusting: false,
        radius: 14,
        invincible: 0,
      };
    }

    function makeAsteroid(x,y,size=3){
      const speed = {1: 120, 2: 80, 3: 60}[size] || 50;
      const angle = Math.random()*TAU;
      const jag = randRange(0.6, 1.0);
      const verts = 8 + (size===3?4:(size===2?2:0)) + (Math.random()*2|0);
      const r = {1:16,2:28,3:46}[size];
      const points = Array.from({length:verts},(_,i)=>{
        const a = i/verts*TAU + randRange(-0.08,0.08);
        const rad = r * (0.7 + Math.random()*0.6) * jag;
        return {a, rad};
      });
      return {
        x, y,
        vx: Math.cos(angle)*randRange(speed*0.5, speed),
        vy: Math.sin(angle)*randRange(speed*0.5, speed),
        angle: randRange(0,TAU),
        spin: randRange(-0.8,0.8),
        size,
        radius: r,
        points
      };
    }

    function makeBullet(x,y,angle,shipV){
      const speed = 360;
      return { x, y, vx: Math.cos(angle)*speed + shipV.vx, vy: Math.sin(angle)*speed + shipV.vy, angle, life: 0, maxLife: 0.9, radius: 2 };
    }

    function spawnWave(level){
      game.asteroids.length = 0;
      const count = 3 + level;
      for(let i=0;i<count;i++){
        let x,y;
        const edge = Math.random();
        if(edge < 0.5){ x = Math.random()*canvas.clientWidth; y = (Math.random()<0.5? -40 : canvas.clientHeight+40); }
        else { x = (Math.random()<0.5? -40 : canvas.clientWidth+40); y = Math.random()*canvas.clientHeight; }
        game.asteroids.push( makeAsteroid(x,y,3) );
      }
    }

    function reset(){
      game.score=0; game.lives=3; game.level=1;
      game.bullets.length=0; game.particles.length=0;
      game.ship = makeShip();
      spawnWave(game.level);
      updateHUD();
    }

    function updateHUD(){
      scoreEl.textContent = game.score|0;
      livesEl.textContent = game.lives;
      levelEl.textContent = game.level;
    }

    // ----- Input -----
    const keys = new Set();
    window.addEventListener('keydown', (e)=>{
      if(e.repeat) return;
      if(state===State.SPLASH && (e.key==='Enter' || e.key===' ')) { start(); return; }
      if(e.key==='/' || e.key===':') { openCmd(); e.preventDefault(); return; }
      if(e.key==='p' || e.key==='P'){ togglePause(); return; }
      keys.add(e.key);
    });
    window.addEventListener('keyup', (e)=>{ keys.delete(e.key); });

    function openCmd(){ cmdWrap.style.display='block'; cmd.value=''; cmd.focus(); }
    function closeCmd(){ cmdWrap.style.display='none'; canvas.focus(); }

    cmd.addEventListener('keydown', (e)=>{
      if(e.key==='Escape'){ closeCmd(); return; }
      if(e.key==='Enter'){
        const val = cmd.value.trim().toLowerCase();
        if(val==='pause') { pause(); }
        else if(val==='resume' || val==='unpause') { resume(); }
        else if(val==='restart') { start(true); }
        else if(val==='start') { if(state===State.SPLASH||state===State.GAMEOVER) start(); }
        else if(val==='help') {
          alert('Commands: pause, resume, restart, start');
        }
        closeCmd();
      }
    });

    // ----- Game Flow -----
    function start(forceRestart=false){
      if(state===State.PAUSED && !forceRestart){ resume(); return; }
      splash.style.display='none';
      pauseOverlay.style.display='none';
      reset();
      state = State.PLAYING;
    }

    function pause(){
      if(state!==State.PLAYING) return;
      state = State.PAUSED;
      pauseOverlay.style.display='flex';
    }

    function resume(){
      if(state!==State.PAUSED) return;
      state = State.PLAYING;
      pauseOverlay.style.display='none';
    }

    function togglePause(){ (state===State.PLAYING) ? pause() : (state===State.PAUSED ? resume() : void 0); }

    startBtn.addEventListener('click', ()=> start());
    resumeBtn?.addEventListener('click', ()=> resume());
    restartBtn?.addEventListener('click', ()=> start(true));

    // ----- Rendering -----
    function wrap(obj){
      const w = canvas.clientWidth, h = canvas.clientHeight;
      if(obj.x < -50) obj.x = w+50; else if(obj.x > w+50) obj.x = -50;
      if(obj.y < -50) obj.y = h+50; else if(obj.y > h+50) obj.y = -50;
    }

    function drawShip(s){
      ctx.save();
      ctx.translate(s.x, s.y); ctx.rotate(s.angle);
      ctx.strokeStyle = '#cde1ff'; ctx.lineWidth = 2; ctx.fillStyle = 'transparent';
      ctx.beginPath();
      ctx.moveTo(16,0); ctx.lineTo(-12,-10); ctx.lineTo(-6,-6); ctx.lineTo(-12,10); ctx.closePath();
      ctx.stroke();
      // thrust flame
      if(s.thrusting){
        ctx.beginPath(); ctx.moveTo(-12,0); ctx.lineTo(-22,0); ctx.strokeStyle = '#68d391'; ctx.stroke();
      }
      // shield when invincible
      if(s.invincible>0){ ctx.beginPath(); ctx.arc(0,0,s.radius+6,0,TAU); ctx.strokeStyle='rgba(104,211,145,.5)'; ctx.stroke(); }
      ctx.restore();
    }

    function drawAsteroid(a){
      ctx.save(); ctx.translate(a.x,a.y); ctx.rotate(a.angle);
      ctx.strokeStyle = '#9fb3d9'; ctx.lineWidth = 2; ctx.beginPath();
      for(let i=0;i<a.points.length;i++){
        const p = a.points[i];
        const x = Math.cos(p.a) * p.rad;
        const y = Math.sin(p.a) * p.rad;
        i? ctx.lineTo(x,y) : ctx.moveTo(x,y);
      }
      ctx.closePath(); ctx.stroke();
      ctx.restore();
    }

    function drawBullet(b){
      ctx.beginPath(); ctx.arc(b.x,b.y,2,0,TAU); ctx.fillStyle='#e8f0fe'; ctx.fill();
    }

    function drawParticles(){
      ctx.save();
      for(let i=game.particles.length-1;i>=0;i--){
        const p = game.particles[i];
        p.x += p.vx*p.dt; p.y += p.vy*p.dt; p.life -= p.dt;
        if(p.life<=0){ game.particles.splice(i,1); continue; }
        wrap(p);
        ctx.globalAlpha = clamp(p.life/p.max,0,1);
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x,p.y,2,2);
      }
      ctx.globalAlpha = 1; ctx.restore();
    }

    function boom(x,y,color='#ffcc70'){
      for(let i=0;i<28;i++){
        game.particles.push({x,y,vx:randRange(-180,180),vy:randRange(-180,180),life:randRange(.2,.8),max:0.8,dt:0.016,color});
      }
    }

    // ----- Physics & Collisions -----
    function circleHit(a,b){
      const dx=a.x-b.x, dy=a.y-b.y; const r=(a.radius||0)+(b.radius||0);
      return dx*dx+dy*dy <= r*r;
    }

    // ----- Main Loop -----
    let last = performance.now();
    function loop(now){
      requestAnimationFrame(loop);
      const dt = clamp((now-last)/1000, 0, 0.033); last = now;

      // Update logic
      if(state===State.PLAYING){
        const s = game.ship;
        s.thrusting = keys.has('ArrowUp') || keys.has('w') || keys.has('W');
        if(keys.has('ArrowLeft') || keys.has('a') || keys.has('A')) s.angle -= 3*dt;
        if(keys.has('ArrowRight') || keys.has('d') || keys.has('D')) s.angle += 3*dt;

        // thrust
        if(s.thrusting){ s.vx += Math.cos(s.angle)*200*dt; s.vy += Math.sin(s.angle)*200*dt; }
        // drag
        s.vx *= 0.995; s.vy *= 0.995;
        s.x += s.vx*dt; s.y += s.vy*dt; wrap(s);
        if(s.invincible>0) s.invincible -= dt;

        // shooting
        if((keys.has(' ') || keys.has('Space')) && now - game.lastShot > 140){
          game.bullets.push( makeBullet(s.x+Math.cos(s.angle)*16, s.y+Math.sin(s.angle)*16, s.angle, s) );
          game.lastShot = now;
        }

        // bullets update
        for(let i=game.bullets.length-1;i>=0;i--){
          const b = game.bullets[i];
          b.life += dt; if(b.life>b.maxLife){ game.bullets.splice(i,1); continue; }
          b.x += b.vx*dt; b.y += b.vy*dt; wrap(b);
        }

        // asteroids update
        if(game.asteroids.length===0){ game.level++; spawnWave(game.level); updateHUD(); }
        for(const a of game.asteroids){ a.x += a.vx*dt; a.y += a.vy*dt; a.angle += a.spin*dt; wrap(a); }

        // collisions: bullets vs asteroids
        for(let i=game.asteroids.length-1;i>=0;i--){
          const a = game.asteroids[i];
          for(let j=game.bullets.length-1;j>=0;j--){
            const b = game.bullets[j];
            if(circleHit(a,b)){
              game.bullets.splice(j,1);
              game.asteroids.splice(i,1);
              boom(a.x,a.y,'#ffd580');
              const next = a.size-1;
              if(next>=1){
                for(let k=0;k<2;k++){
                  const child = makeAsteroid(a.x,a.y,next);
                  game.asteroids.push(child);
                }
              }
              game.score += {1:100,2:50,3:20}[a.size]||10; updateHUD();
              break;
            }
          }
        }

        // collisions: ship vs asteroids
        if(game.ship && game.ship.invincible<=0){
          for(const a of game.asteroids){
            if(circleHit(a, game.ship)){
              boom(game.ship.x, game.ship.y, '#ff6b6b');
              game.lives--; updateHUD();
              if(game.lives<=0){
                state = State.GAMEOVER;
                splash.style.display='flex';
                splash.querySelector('h2').textContent = 'Game Over — Score: '+(game.score|0);
              } else {
                game.ship = makeShip();
                game.ship.invincible = 2.2;
              }
              break;
            }
          }
        }
      }

      // Draw
      ctx.clearRect(0,0,canvas.clientWidth,canvas.clientHeight);

      // subtle starfield
      const w=canvas.clientWidth,h=canvas.clientHeight;
      ctx.globalAlpha = 0.25; for(let i=0;i<60;i++){ ctx.fillRect((i*73%w), (i*127%h), 1, 1); } ctx.globalAlpha=1;

      if(game.ship) drawShip(game.ship);
      for(const a of game.asteroids) drawAsteroid(a);
      for(const b of game.bullets) drawBullet(b);
      drawParticles();

      // Heads-up pause indicator
      if(state===State.PAUSED){
        ctx.save(); ctx.globalAlpha=.75; ctx.fillStyle='rgba(0,0,0,.4)'; ctx.fillRect(0,0,w,h); ctx.restore();
      }
    }
    requestAnimationFrame(loop);

    // Start sitting at splash
  })();
  </script>
</body>
</html>
