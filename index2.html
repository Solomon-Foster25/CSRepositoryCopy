<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Asteroids — Single Page with Powerups</title>
  <style>
    :root{
      --bg:#0b0f14; --fg:#e8f0fe; --accent:#68d391; --muted:#9aa0a6; --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--fg);overflow:hidden}
    #game{position:fixed;inset:0;background:radial-gradient(1200px 800px at 50% 40%,#121826 0%,#0b0f14 60%,#070a0f 100%)}

    .overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
    .panel{pointer-events:auto;background:rgba(10,14,20,.8);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.08);box-shadow:0 20px 60px rgba(0,0,0,.5);border-radius:20px;padding:32px;max-width:680px;width:min(92%,680px);text-align:center}
    h1{font-weight:800;letter-spacing:.5px;margin:.2rem 0 0;font-size:clamp(28px,4vw,44px)}
    h2{font-weight:700;margin:0 0 1rem;font-size:clamp(18px,2.2vw,22px);color:var(--muted)}
    .btn{display:inline-flex;gap:.6rem;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,.15);border-radius:14px;padding:12px 18px;font-weight:700;cursor:pointer;background:linear-gradient(180deg,#1a2332,#101827);color:var(--fg);transition:transform .08s ease, box-shadow .2s ease}
    .btn:hover{transform:translateY(-1px);box-shadow:0 8px 24px rgba(0,0,0,.35)}
    .btn:active{transform:translateY(0)}
    .grid{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));margin-top:14px;text-align:left}
    .kbd{display:inline-block;border:1px solid rgba(255,255,255,.2);border-bottom-width:3px;border-radius:8px;padding:.2rem .45rem;font-family:ui-monospace,Consolas,monospace;background:#0e1522}
    .muted{color:var(--muted)}

    #hud{position:fixed;inset:0;pointer-events:none;padding:14px;display:flex;justify-content:space-between;align-items:flex-start;font-weight:700;letter-spacing:.2px}
    #hud .left, #hud .right{display:flex;gap:16px;align-items:center}
    #hud .chip{background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.1);border-radius:999px;padding:6px 10px}
    #hud .pause{position:fixed;left:50%;top:12px;transform:translateX(-50%);background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:6px 12px}

    #pauseOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center}
    #pauseOverlay .panel{border-color:rgba(255,255,255,.18)}

    /* Command palette */
    #cmdWrap{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);width:min(760px,92%);display:none}
    #cmd{width:100%;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.16);background:rgba(6,10,16,.9);backdrop-filter:blur(6px);color:var(--fg);font-size:16px;outline:none}
    #cmd::placeholder{color:#7a8699}

    .btn:focus-visible, #cmd:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
  </style>
</head>
<body>
  <canvas id="game"></canvas>

  <div id="hud">
    <div class="left">
      <div class="chip">Score: <span id="score">0</span></div>
      <div class="chip">Lives: <span id="lives">3</span></div>
      <div class="chip">Level: <span id="level">1</span></div>
    </div>
    <div class="right">
      <div class="chip muted">Press <span class="kbd">P</span> to Pause</div>
    </div>
  </div>

  <div class="overlay" id="splash">
    <div class="panel">
      <h1>ASTEROIDS</h1>
      <h2>Single‑file HTML5 edition</h2>
      <button id="startBtn" class="btn">▶ Start</button>
    </div>
  </div>

  <div id="pauseOverlay" class="overlay">
    <div class="panel">
      <h1>Paused</h1>
      <button id="resumeBtn" class="btn">⏯ Resume</button>
      <button id="restartBtn" class="btn">↻ Restart</button>
    </div>
  </div>

  <div id="cmdWrap"><input id="cmd" type="text" placeholder="Type a command… (pause, resume, restart, start)" autocomplete="off" /></div>

  <script>
  (()=>{
    const canvas=document.getElementById('game');
    const ctx=canvas.getContext('2d');

    const scoreEl=document.getElementById('score');
    const livesEl=document.getElementById('lives');
    const levelEl=document.getElementById('level');

    const splash=document.getElementById('splash');
    const startBtn=document.getElementById('startBtn');
    const pauseOverlay=document.getElementById('pauseOverlay');
    const resumeBtn=document.getElementById('resumeBtn');
    const restartBtn=document.getElementById('restartBtn');
    const cmdWrap=document.getElementById('cmdWrap');
    const cmd=document.getElementById('cmd');

    const randRange=(min,max)=>Math.random()*(max-min)+min;
    const clamp=(v,min,max)=>v<min?min:(v>max?max:v);
    const TAU=Math.PI*2;

    function fitCanvas(){
      canvas.width=innerWidth;canvas.height=innerHeight;
    }
    window.addEventListener('resize',fitCanvas);fitCanvas();

    const State={SPLASH:'splash',PLAYING:'playing',PAUSED:'paused',GAMEOVER:'gameover'};
    let state=State.SPLASH;

    const game={score:0,lives:3,level:1,ship:null,bullets:[],asteroids:[],particles:[],powerups:[],lastShot:0,rapidTimer:0,shieldTimer:0};

    function makeShip(){return{x:canvas.width/2,y:canvas.height/2,vx:0,vy:0,angle:-Math.PI/2,thrusting:false,radius:14,invincible:0};}

    function makeAsteroid(x,y,size=3){
      const speed={1:120,2:80,3:60}[size]||50;
      const angle=Math.random()*TAU;
      const jag=randRange(0.6,1.0);
      const verts=8+(size===3?4:(size===2?2:0))+(Math.random()*2|0);
      const r={1:16,2:28,3:46}[size];
      const points=Array.from({length:verts},(_,i)=>{const a=i/verts*TAU+randRange(-0.08,0.08);const rad=r*(0.7+Math.random()*0.6)*jag;return{a,rad};});
      return{x,y,vx:Math.cos(angle)*randRange(speed*0.5,speed),vy:Math.sin(angle)*randRange(speed*0.5,speed),angle:randRange(0,TAU),spin:randRange(-0.8,0.8),size,radius:r,points};
    }

    function makeBullet(x,y,angle,shipV){
      const speed=360;
      return{x,y,vx:Math.cos(angle)*speed+shipV.vx,vy:Math.sin(angle)*speed+shipV.vy,life:0,maxLife:0.9,radius:2};
    }

    function makePowerup(x,y){
      const types=['life','rapid','shield'];
      const type=types[Math.floor(Math.random()*types.length)];
      return{x,y,type,radius:12,vx:randRange(-40,40),vy:randRange(-40,40),life:8};
    }

    function spawnWave(level){
      game.asteroids.length=0;
      const count=3+level;
      for(let i=0;i<count;i++){
        let x,y;const edge=Math.random();
        if(edge<0.5){x=Math.random()*canvas.width;y=(Math.random()<0.5?-40:canvas.height+40);}else{x=(Math.random()<0.5?-40:canvas.width+40);y=Math.random()*canvas.height;}
        game.asteroids.push(makeAsteroid(x,y,3));
      }
    }

    function reset(){game.score=0;game.lives=3;game.level=1;game.bullets=[];game.particles=[];game.powerups=[];game.ship=makeShip();spawnWave(game.level);updateHUD();}
    function updateHUD(){scoreEl.textContent=game.score|0;livesEl.textContent=game.lives;levelEl.textContent=game.level;}

    const keys=new Set();
    window.addEventListener('keydown',e=>{if(e.repeat)return;if(state===State.SPLASH&&(e.key==='Enter'||e.key===' ')){start();return;}if(e.key==='/'||e.key===':'){openCmd();e.preventDefault();return;}if(e.key==='p'||e.key==='P'){togglePause();return;}keys.add(e.key);});
    window.addEventListener('keyup',e=>{keys.delete(e.key);});

    function openCmd(){cmdWrap.style.display='block';cmd.value='';cmd.focus();}
    function closeCmd(){cmdWrap.style.display='none';canvas.focus();}

    cmd.addEventListener('keydown',e=>{if(e.key==='Escape'){closeCmd();return;}if(e.key==='Enter'){const val=cmd.value.trim().toLowerCase();if(val==='pause'){pause();}else if(val==='resume'){resume();}else if(val==='restart'){start(true);}else if(val==='start'){if(state===State.SPLASH||state===State.GAMEOVER)start();}closeCmd();}});

    function start(forceRestart=false){if(state===State.PAUSED&&!forceRestart){resume();return;}splash.style.display='none';pauseOverlay.style.display='none';reset();state=State.PLAYING;}
    function pause(){if(state!==State.PLAYING)return;state=State.PAUSED;pauseOverlay.style.display='flex';}
    function resume(){if(state!==State.PAUSED)return;state=State.PLAYING;pauseOverlay.style.display='none';}
    function togglePause(){(state===State.PLAYING)?pause():(state===State.PAUSED?resume():void 0);}

    startBtn.onclick=()=>start();resumeBtn.onclick=()=>resume();restartBtn.onclick=()=>start(true);

    function wrap(o){if(o.x<-50)o.x=canvas.width+50;else if(o.x>canvas.width+50)o.x=-50;if(o.y<-50)o.y=canvas.height+50;else if(o.y>canvas.height+50)o.y=-50;}

    function drawShip(s){ctx.save();ctx.translate(s.x,s.y);ctx.rotate(s.angle);ctx.strokeStyle='#cde1ff';ctx.lineWidth=2;ctx.beginPath();ctx.moveTo(16,0);ctx.lineTo(-12,-10);ctx.lineTo(-6,-6);ctx.lineTo(-12,10);ctx.closePath();ctx.stroke();if(s.thrusting){ctx.beginPath();ctx.moveTo(-12,0);ctx.lineTo(-22,0);ctx.strokeStyle='#68d391';ctx.stroke();}if(s.invincible>0||game.shieldTimer>0){ctx.beginPath();ctx.arc(0,0,s.radius+6,0,TAU);ctx.strokeStyle='rgba(104,211,145,.6)';ctx.stroke();}ctx.restore();}
    function drawAsteroid(a){ctx.save();ctx.translate(a.x,a.y);ctx.rotate(a.angle);ctx.strokeStyle='#9fb3d9';ctx.beginPath();for(let i=0;i<a.points.length;i++){const p=a.points[i];const x=Math.cos(p.a)*p.rad;const y=Math.sin(p.a)*p.rad;i?ctx.lineTo(x,y):ctx.moveTo(x,y);}ctx.closePath();ctx.stroke();ctx.restore();}
    function drawBullet(b){ctx.beginPath();ctx.arc(b.x,b.y,2,0,TAU);ctx.fillStyle='#e8f0fe';ctx.fill();}
    function drawPowerup(p){ctx.beginPath();ctx.arc(p.x,p.y,p.radius,0,TAU);ctx.fillStyle=p.type==='life'?'#0f0':p.type==='rapid'?'#0ff':'#ff0';ctx.fill();}

    function circleHit(a,b){const dx=a.x-b.x,dy=a.y-b.y;const r=(a.radius||0)+(b.radius||0);return dx*dx+dy*dy<=r*r;}

    let last=performance.now();
    function loop(now){requestAnimationFrame(loop);const dt=clamp((now-last)/1000,0,0.033);last=now;
      if(state===State.PLAYING){const s=game.ship;s.thrusting=keys.has('ArrowUp');if(keys.has('ArrowLeft'))s.angle-=3*dt;if(keys.has('ArrowRight'))s.angle+=3*dt;if(s.thrusting){s.vx+=Math.cos(s.angle)*200*dt;s.vy+=Math.sin(s.angle)*200*dt;}s.vx*=0.995;s.vy*=0.995;s.x+=s.vx*dt;s.y+=s.vy*dt;wrap(s);if(s.invincible>0)s.invincible-=dt;if(game.rapidTimer>0)game.rapidTimer-=dt;if(game.shieldTimer>0)game.shieldTimer-=dt;
        const shotDelay=game.rapidTimer>0?70:140;
        if(keys.has(' ')&&now-game.lastShot>shotDelay){game.bullets.push(makeBullet(s.x+Math.cos(s.angle)*16,s.y+Math.sin(s.angle)*16,s.angle,s));game.lastShot=now;}
        for(let i=game.bullets.length-1;i>=0;i--){const b=game.bullets[i];b.life+=dt;if(b.life>b.maxLife){game.bullets.splice(i,1);continue;}b.x+=b.vx*dt;b.y+=b.vy*dt;wrap(b);}
        if(game.asteroids.length===0){game.level++;spawnWave(game.level);updateHUD();}
        for(const a of game.asteroids){a.x+=a.vx*dt;a.y+=a.vy*dt;a.angle+=a.spin*dt;wrap(a);}
        for(let i=game.asteroids.length-1;i>=0;i--){const a=game.asteroids[i];for(let j=game.bullets.length-1;j>=0;j--){const b=game.bullets[j];if(circleHit(a,b)){game.bullets.splice(j,1);game.asteroids.splice(i,1);if(Math.random()<0.2){game.powerups.push(makePowerup(a.x,a.y));}game.score+={1:100,2:50,3:20}[a.size]||10;updateHUD();break;}}}
        if(game.ship&&game.ship.invincible<=0&&game.shieldTimer<=0){for(const a of game.asteroids){if(circleHit(a,game.ship)){game.lives--;updateHUD();if(game.lives<=0){state=State.GAMEOVER;splash.style.display='flex';splash.querySelector('h2').textContent='Game Over — Score: '+(game.score|0);}else{game.ship=makeShip();game.ship.invincible=2.2;}break;}}}
        for(let i=game.powerups.length-1;i>=0;i--){const p=game.powerups[i];p.x+=p.vx*dt;p.y+=p.vy*dt;p.life-=dt;wrap(p);if(p.life<=0){game.powerups.splice(i,
